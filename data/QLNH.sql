Create database QLNH
Use QLNH
-- Xóa các bảng nếu đã tồn tại (theo thứ tự ngược để tránh lỗi FK)
IF OBJECT_ID('dbo.BAOCAO', 'U') IS NOT NULL DROP TABLE dbo.BAOCAO;
IF OBJECT_ID('dbo.CT_HOADON', 'U') IS NOT NULL DROP TABLE dbo.CT_HOADON;
IF OBJECT_ID('dbo.HOADON', 'U') IS NOT NULL DROP TABLE dbo.HOADON;
IF OBJECT_ID('dbo.BANDAT', 'U') IS NOT NULL DROP TABLE dbo.BANDAT;
IF OBJECT_ID('dbo.KHUYENMAI', 'U') IS NOT NULL DROP TABLE dbo.KHUYENMAI;
IF OBJECT_ID('dbo.MONAN', 'U') IS NOT NULL DROP TABLE dbo.MONAN;
IF OBJECT_ID('dbo.BAN', 'U') IS NOT NULL DROP TABLE dbo.BAN;
IF OBJECT_ID('dbo.KHACHHANG', 'U') IS NOT NULL DROP TABLE dbo.KHACHHANG;
IF OBJECT_ID('dbo.THETHANHVIEN', 'U') IS NOT NULL DROP TABLE dbo.THETHANHVIEN;
IF OBJECT_ID('dbo.TAIKHOAN', 'U') IS NOT NULL DROP TABLE dbo.TAIKHOAN;
IF OBJECT_ID('dbo.NHANVIEN', 'U') IS NOT NULL DROP TABLE dbo.NHANVIEN;
IF OBJECT_ID('dbo.QUANLY', 'U') IS NOT NULL DROP TABLE dbo.QUANLY;

GO
CREATE TABLE QUANLY (
    maQL NVARCHAR(10) PRIMARY KEY,
    hoTen NVARCHAR(50),
    email NVARCHAR(50),
    soDienThoai NVARCHAR(15)
);

CREATE TABLE KHUYENMAI (
    maKM NVARCHAR(10) PRIMARY KEY,
    tenKM NVARCHAR(50),
    moTa NVARCHAR(100),
    phanTramGiam FLOAT,
    ngayKetThuc DATE,
    maQL NVARCHAR(10),
    FOREIGN KEY (maQL) REFERENCES QUANLY(maQL)
);

CREATE TABLE NHANVIEN (
    maNV NVARCHAR(10) PRIMARY KEY,
    hoTen NVARCHAR(50),
    CCCD NVARCHAR(20),
    soDienThoai NVARCHAR(15),
    email NVARCHAR(50),
    ngaySinh DATE,
    trangThai NVARCHAR(20),
    maQL NVARCHAR(10),
    FOREIGN KEY (maQL) REFERENCES QUANLY(maQL)
);

CREATE TABLE TAIKHOAN (
    tenDangNhap NVARCHAR(50) PRIMARY KEY,
    matKhau NVARCHAR(50),
    vaiTro NVARCHAR(20),
    trangThai NVARCHAR(20),         -- 🔹 Thêm thuộc tính trạng thái tài khoản
    maNV NVARCHAR(10),
    maQL NVARCHAR(10),
    FOREIGN KEY (maNV) REFERENCES NHANVIEN(maNV),
    FOREIGN KEY (maQL) REFERENCES QUANLY(maQL)
);

CREATE TABLE KHACHHANG (
    maKH NVARCHAR(10) PRIMARY KEY,
    hoTenKH NVARCHAR(50),
    soDienThoai NVARCHAR(15),
    email NVARCHAR(50),
    gioiTinh BIT,
    maNV NVARCHAR(10),
    FOREIGN KEY (maNV) REFERENCES NHANVIEN(maNV)
);

CREATE TABLE THETHANHVIEN (
    maThe NVARCHAR(10) PRIMARY KEY,
    maKH NVARCHAR(10),
    diemTichLuy INT,
    FOREIGN KEY (maKH) REFERENCES KHACHHANG(maKH)
);

CREATE TABLE BAN (
    maBan NVARCHAR(10) PRIMARY KEY,
    sucChua INT,
    trangThai NVARCHAR(20)
);

CREATE TABLE BANDAT (
    maDatBan NVARCHAR(10) PRIMARY KEY,
    maKH NVARCHAR(10),
    maBan NVARCHAR(10),
    soLuongKhach INT,
    tienCoc FLOAT,
    trangThai NVARCHAR(20),
    FOREIGN KEY (maKH) REFERENCES KHACHHANG(maKH),
    FOREIGN KEY (maBan) REFERENCES BAN(maBan)
);

CREATE TABLE MONAN (
    maMon NVARCHAR(10) PRIMARY KEY,
    tenMon NVARCHAR(50),
    loaiMon NVARCHAR(50),
    giaMon FLOAT,
    ghiChu NVARCHAR(100),
    maQL NVARCHAR(10),
    FOREIGN KEY (maQL) REFERENCES QUANLY(maQL)
);

CREATE TABLE HOADON (
    maHD NVARCHAR(10) PRIMARY KEY,
    maThe NVARCHAR(10),
    maNV NVARCHAR(10),
    maDatBan NVARCHAR(10),
    maKM NVARCHAR(10),
    ngayLap DATETIME,
    tongTien FLOAT,
    FOREIGN KEY (maThe) REFERENCES THETHANHVIEN(maThe),
    FOREIGN KEY (maNV) REFERENCES NHANVIEN(maNV),
    FOREIGN KEY (maDatBan) REFERENCES BANDAT(maDatBan),
    FOREIGN KEY (maKM) REFERENCES KHUYENMAI(maKM)
);

CREATE TABLE CT_HOADON (
    maHD NVARCHAR(10),
    maMon NVARCHAR(10),
    soLuong INT,
    thanhTien FLOAT,
    PRIMARY KEY (maHD, maMon),
    FOREIGN KEY (maHD) REFERENCES HOADON(maHD),
    FOREIGN KEY (maMon) REFERENCES MONAN(maMon)
);

CREATE TABLE BAOCAO (
    maBC NVARCHAR(10) PRIMARY KEY,
    ngayBatDau DATE,
    ngayKetThuc DATE,
    doanhThu FLOAT,
    maNV NVARCHAR(10),
    maQL NVARCHAR(10),
    maHD NVARCHAR(10),
    FOREIGN KEY (maNV) REFERENCES NHANVIEN(maNV),
    FOREIGN KEY (maQL) REFERENCES QUANLY(maQL),
    FOREIGN KEY (maHD) REFERENCES HOADON(maHD)
);
